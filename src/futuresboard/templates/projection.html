{% extends "base.html" %}
{% block title %}Projection{% endblock %}
{% block content %}
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h3><i class="fas fa-chart-line"></i> Projection</h3>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card text-center">
                <div class="card-header text-muted">
                    Balance projection visualised
                </div>
                <canvas id="lineChart" height="400"></canvas>
            </div>
        </div>
    </div>
    <br>

    <div class="row">
        <div class="col-md-12">
            <div class="card text-center">
                <div class="card-header text-muted">
                    Balance projection breakdown
                </div>
                <table id="hype" class='table table-sm table-bordered text-center'>
                    <thead class="thead-dark">
                        <tr>
                            <th>Daily %</th>
                            <th>30 days</th>
                            <th>60 days</th>
                            <th>90 days</th>
                            <th>120 days</th>
                            <th>240 days</th>
                            <th>365 days</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0.3%</td>
                            <td>{{ data["p03"][30]|round(2) }}</td>
                            <td>{{ data["p03"][60]|round(2) }}</td>
                            <td>{{ data["p03"][90]|round(2) }}</td>
                            <td>{{ data["p03"][120]|round(2) }}</td>
                            <td>{{ data["p03"][240]|round(2) }}</td>
                            <td>{{ data["p03"][-1]|round(2) }}</td>
                        </tr>
                        <tr>
                            <td>0.5%</td>
                            <td>{{ data["p05"][30]|round(2) }}</td>
                            <td>{{ data["p05"][60]|round(2) }}</td>
                            <td>{{ data["p05"][90]|round(2) }}</td>
                            <td>{{ data["p05"][120]|round(2) }}</td>
                            <td>{{ data["p05"][240]|round(2) }}</td>
                            <td>{{ data["p05"][-1]|round(2) }}</td>
                        </tr>
                        <tr>
                            <td>1%</td>
                            <td>{{ data["p10"][30]|round(2) }}</td>
                            <td>{{ data["p10"][60]|round(2) }}</td>
                            <td>{{ data["p10"][90]|round(2) }}</td>
                            <td>{{ data["p10"][120]|round(2) }}</td>
                            <td>{{ data["p10"][240]|round(2) }}</td>
                            <td>{{ data["p10"][-1]|round(2) }}</td>
                        </tr>
                        <tr>
                            <td>1.2%</td>
                            <td>{{ data["p15"][30]|round(2) }}</td>
                            <td>{{ data["p15"][60]|round(2) }}</td>
                            <td>{{ data["p15"][90]|round(2) }}</td>
                            <td>{{ data["p15"][120]|round(2) }}</td>
                            <td>{{ data["p15"][240]|round(2) }}</td>
                            <td>{{ data["p15"][-1]|round(2) }}</td>
                        </tr>
                        <tr>
                            <td>{{ data["pcustom_value"] }}% (avg past 7 days)</td>
                            <td>{{ data["pcustom"][30]|round(2) }}</td>
                            <td>{{ data["pcustom"][60]|round(2) }}</td>
                            <td>{{ data["pcustom"][90]|round(2) }}</td>
                            <td>{{ data["pcustom"][120]|round(2) }}</td>
                            <td>{{ data["pcustom"][240]|round(2) }}</td>
                            <td>{{ data["pcustom"][-1]|round(2) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>

        $(document).ready( function () {
            $('#hype').DataTable({
                "paging": false,
                "searching": false,
                "order": [],
                "info": false,
            });
        } );

        Chart.register(ChartDataLabels);

        const data = {
            labels: {{ data["dates"] | safe }},
            datasets: [
                {
                    label: '0.30%',
                    data: {{ data["p03"] }},
                    fill: false,
                    borderColor: 'rgba(153, 102, 255, 0.3)',
                    tension: 0.1,
                },
                {
                    label: '0.50%',
                    data: {{ data["p05"] }},
                    fill: false,
                    borderColor: 'rgba(255, 99, 132, 0.3)',
                    tension: 0.1,
                },
                {
                    label: '1%',
                    data: {{ data["p10"] }},
                    fill: false,
                    borderColor: 'rgba(255, 159, 64, 0.3)',
                    tension: 0.1,
                },
                {
                    label: '1.2%',
                    data: {{ data["p15"] }},
                    fill: false,
                    borderColor: 'rgba(240, 234, 151, 0.3)',
                    tension: 0.1,
                },
                {
                    label: '{{ data["pcustom_value"] }}%',
                    data: {{ data["pcustom"] }},
                    fill: false,
                    borderColor: 'rgba(75, 192, 192, 0.3)',
                    tension: 0.1,
                },
            ]
        };
        const config2 = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                layout: {
                    padding: {
                        top: 20
                    }
                },
                plugins:{
                    datalabels: {
                        display: false
                    },
                },
                scales: {
                    y: {
                        type: 'linear',
                        ticks: {
                            autoSkip: false,
                        }
                    }
                }
            }
        };

        var myChart = new Chart(
            document.getElementById('lineChart'),
            config2
        );
    </script>
{% endblock %}
